<main
  class="home"
  data-controller="home-context-menu"
  data-action="
    contextmenu->home-context-menu#open
    pointerdown->home-context-menu#close
    keydown.esc@window->home-context-menu#closeWithEscape
  "
>
  <h1 class="home__title">manuscriptOS</h1>
  <section
    class="home__desktop"
    aria-label="Desktop"
    data-controller="desktop"
    data-action="click->desktop#select"
    data-desktop-shortcuts-value="<%= json_escape(@desktop_shortcuts.to_json) %>"
  ></section>
  <% @notes.each do |note| %>
    <div
      class="home__note"
      data-controller="draggable"
      data-draggable-handle-selector-value=".ig-note__titlebar"
      data-draggable-persist-path-value="/notes/<%= note[:id] %>/position"
      <% if note[:top].present? %>
        data-draggable-top-value="<%= note[:top] %>"
      <% elsif note[:bottom].present? %>
        data-draggable-bottom-value="<%= note[:bottom] %>"
      <% else %>
        data-draggable-top-value="55"
      <% end %>
      <% if note[:left].present? %>
        data-draggable-left-value="<%= note[:left] %>"
      <% elsif note[:right].present? %>
        data-draggable-right-value="<%= note[:right] %>"
      <% else %>
        data-draggable-left-value="48"
      <% end %>
      data-action="
        pointerdown->draggable#start
        pointermove->draggable#move
        pointerup->draggable#end
        pointercancel->draggable#end
      "
    >
      <%= render "shared/ig_note",
        title: note[:title].presence || "Untitled Note",
        content: note[:content].presence || "No note found.",
        variant: note[:variant],
        mode: "expanded",
        width: note[:width],
        height: note[:height] %>
    </div>
  <% end %>

  <div class="home__context-menu" data-home-context-menu-target="menu" hidden>
    <%= render "shared/ig_menu",
      items: [
        { label: "New Scene", intent: "new_scene", kind: "action" },
        { label: "New Draft", intent: "new_draft", kind: "action" },
        { label: "New Book", intent: "new_book", kind: "action" }
      ] %>
  </div>
</main>
