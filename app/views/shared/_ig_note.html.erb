<%
  raise ArgumentError, "IGNote requires :content" unless local_assigns.key?(:content)

  note_variant = ig_note_variant(local_assigns[:variant])
  note_mode = ig_note_mode(local_assigns[:mode])
  note_title = local_assigns[:title].presence || "Note"
  note_body_id = local_assigns[:body_id].presence || "ig-note-body-#{SecureRandom.hex(6)}"
  note_expanded = note_mode == "expanded"

  note_classes = ["ig-note", "ig-note--#{note_variant}", "ig-note--#{note_mode}"]
  note_classes << class_name if local_assigns[:class_name].present?

  style_rules = []
  note_width = ig_css_size(local_assigns[:width])
  style_rules << "--ig-note-width: #{note_width}" if note_width.present?

  note_height = ig_css_size(local_assigns[:height])
  if note_height.present? && note_mode == "expanded"
    style_rules << "--ig-note-height: #{note_height}"
  end
%>

<section
  class="<%= note_classes.join(" ") %>"
  role="note"
  aria-label="<%= note_title %>"
  data-controller="ig-note"
  data-note-variant="<%= note_variant %>"
  data-note-mode="<%= note_mode %>"
  <% if style_rules.any? %>style="<%= style_rules.join("; ") %>"<% end %>
>
  <header class="ig-note__titlebar" data-action="click->ig-note#toggle">
    <button
      type="button"
      class="ig-note__toggle ig-note__chrome ig-note__chrome--left"
      aria-label="Toggle note"
      aria-expanded="<%= note_expanded %>"
      aria-controls="<%= note_body_id %>"
      data-ig-note-target="toggleControl"
      data-action="click->ig-note#toggle:stop"
    ></button>
    <h2 class="ig-note__title"><%= note_title %></h2>
    <span class="ig-note__chrome ig-note__chrome--right" aria-hidden="true"></span>
  </header>

  <div
    id="<%= note_body_id %>"
    class="ig-note__body"
    contenteditable="true"
    role="textbox"
    aria-multiline="true"
    spellcheck="true"
    data-ig-note-target="body"
    <%= "hidden" unless note_expanded %>
  ><%= sanitize(content.to_s) %></div>
</section>
